import*as e from"react";import{useMountEffect as r,useUpdateEffect as n}from"primereact/hooks";import{InputText as t}from"primereact/inputtext";import{DomHandler as u,ObjectUtils as c,classNames as a}from"primereact/utils";function l(){return l=Object.assign?Object.assign.bind():function(e){for(var r=1;r<arguments.length;r++){var n=arguments[r];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])}return e},l.apply(this,arguments)}var o=e.memo(e.forwardRef((function(i,f){var s=e.useRef(f),v=e.useRef(null),m=e.useRef(0),p=e.useRef([]),g=e.useRef([]),d=e.useRef(0),h=e.useRef(null),b=e.useRef(!1),y=e.useRef(null),k=e.useRef(null),C=e.useRef(null),R=e.useRef(null),E=e.useRef(null),O=e.useRef(!1),x=function(e,r){var n,t,u,c=s.current;if(c&&c.offsetParent&&c===document.activeElement)return"number"!=typeof e?(c.setSelectionRange?(t=c.selectionStart,u=c.selectionEnd):document.selection&&document.selection.createRange&&(u=(t=0-(n=document.selection.createRange()).duplicate().moveStart("character",-1e5))+n.text.length),{begin:t,end:u}):(t=e,u="number"==typeof r?r:t,void(c.setSelectionRange?c.setSelectionRange(t,u):c.createTextRange&&((n=c.createTextRange()).collapse(!0),n.moveEnd("character",u),n.moveStart("character",t),n.select())))},I=function(){for(var e=v.current;e<=m.current;e++)if(p.current[e]&&g.current[e]===P(e))return!1;return!0},P=e.useCallback((function(e){return i.slotChar.charAt(e<i.slotChar.length?e:0)}),[i.slotChar]),S=function(){return i.unmask?M():s.current&&s.current.value},T=function(e){for(;++e<d.current&&!p.current[e];);return e},j=function(e){for(;--e>=0&&!p.current[e];);return e},A=function(e,r){var n,t;if(!(e<0)){for(n=e,t=T(r);n<d.current;n++)if(p.current[n]){if(!(t<d.current&&p.current[n].test(g.current[t])))break;g.current[n]=g.current[t],g.current[t]=P(t),t=T(t)}B(),x(Math.max(v.current,e))}},w=function(e){var r,n,t,u;for(r=e,n=P(e);r<d.current;r++)if(p.current[r]){if(t=T(r),u=g.current[r],g.current[r]=n,!(t<d.current&&p.current[t].test(u)))break;n=u}},D=function(e){var r=s.current.value,n=x();if(h.current.length&&h.current.length>r.length){for(F(!0);n.begin>0&&!p.current[n.begin-1];)n.begin--;if(0===n.begin)for(;n.begin<v.current&&!p.current[n.begin];)n.begin++;x(n.begin,n.begin)}else{for(F(!0);n.begin<d.current&&!p.current[n.begin];)n.begin++;x(n.begin,n.begin)}i.onComplete&&I()&&i.onComplete({originalEvent:e,value:S()}),N(e)},K=function(e){if(b.current=!1,F(),N(e),q(),i.onBlur&&i.onBlur(e),s.current.value!==y.current){var r=document.createEvent("HTMLEvents");r.initEvent("change",!0,!1),s.current.dispatchEvent(r)}},z=function(e,r){var n;for(n=e;n<r&&n<d.current;n++)p.current[n]&&(g.current[n]=P(n))},B=function(){s.current.value=g.current.join("")},F=function(e){k.current=!0;var r,n,t,u=s.current.value,c=-1;for(r=0,t=0;r<d.current;r++)if(p.current[r]){for(g.current[r]=P(r);t++<u.length;)if(n=u.charAt(t-1),p.current[r].test(n)){g.current[r]=n,c=r;break}if(t>u.length){z(r+1,d.current);break}}else g.current[r]===u.charAt(t)&&t++,r<C.current&&(c=r);return e?B():c+1<C.current?i.autoClear||g.current.join("")===R.current?(s.current.value&&(s.current.value=""),z(0,d.current)):B():(B(),s.current.value=s.current.value.substring(0,c+1)),C.current?r:v.current},L=function(e){if(!i.readOnly){var r=F(!0);x(r),N(e),i.onComplete&&I()&&i.onComplete({originalEvent:e,value:S()})}},M=e.useCallback((function(){for(var e=[],r=0;r<g.current.length;r++){var n=g.current[r];p.current[r]&&n!==P(r)&&e.push(n)}return e.join("")}),[P]),N=function(e){if(i.onChange){var r=i.unmask?M():e&&e.target.value;i.onChange({originalEvent:e,value:R.current!==r?r:"",stopPropagation:function(){},preventDefault:function(){},target:{name:i.name,id:i.id,value:R.current!==r?r:""}})}},q=function(){s.current&&s.current.value&&s.current.value.length>0?u.addClass(s.current,"p-filled"):u.removeClass(s.current,"p-filled")},_=function(e){var r;return s.current&&(null==i.value?s.current.value="":(s.current.value=i.value,r=F(e),setTimeout((function(){if(s.current)return B(),F(e)}),10)),y.current=s.current.value),q(),r},H=e.useCallback((function(){return i.unmask?i.value!==M():R.current!==s.current.value&&s.current.value!==i.value}),[i.unmask,i.value,M]),Z=function(){if(i.mask){p.current=[],C.current=i.mask.length,d.current=i.mask.length,v.current=null;var e={9:"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"};O.current=u.isChrome()&&u.isAndroid();for(var r=i.mask.split(""),n=0;n<r.length;n++){var t=r[n];"?"===t?(d.current--,C.current=n):e[t]?(p.current.push(new RegExp(e[t])),null===v.current&&(v.current=p.current.length-1),n<C.current&&(m.current=p.current.length-1)):p.current.push(null)}g.current=[];for(var c=0;c<r.length;c++){var a=r[c];"?"!==a&&g.current.push(e[a]?P(c):a)}R.current=g.current.join("")}};e.useImperativeHandle(f,(function(){return{props:i,focus:function(){return u.focus(s.current)},getElement:function(){return s.current}}})),e.useEffect((function(){c.combinedRefs(s,f)}),[s,f]),r((function(){Z(),_()})),n((function(){Z(),x(_(!0)),i.unmask&&N()}),[i.mask]),n((function(){H()&&_()}),[H]);var Y=c.findDiffKeys(i,o.defaultProps),G=a("p-inputmask",i.className);return e.createElement(t,l({ref:s,id:i.id,type:i.type,name:i.name,style:i.style,className:G},Y,{placeholder:i.placeholder,size:i.size,maxLength:i.maxLength,tabIndex:i.tabIndex,disabled:i.disabled,readOnly:i.readOnly,onFocus:function(e){var r;i.readOnly||(b.current=!0,clearTimeout(E.current),y.current=s.current.value,r=F(),E.current=setTimeout((function(){s.current===document.activeElement&&(B(),r===i.mask.replace("?","").length?x(0,r):x(r),q())}),10),i.onFocus&&i.onFocus(e))},onBlur:K,onKeyDown:function(e){if(!i.readOnly){var r,n,t,c=e.which||e.keyCode;h.current=s.current.value,8===c||46===c||u.isIOS()&&127===c?((t=(r=x()).end)-(n=r.begin)==0&&(n=46!==c?j(n):t=T(n-1),t=46===c?T(t):t),z(n,t),A(n,t-1),N(e),e.preventDefault()):13===c?(K(e),N(e)):27===c&&(s.current.value=y.current,x(0,F()),N(e),e.preventDefault())}},onKeyPress:function(e){if(!i.readOnly){var r,n,t,c,a=e.which||e.keyCode,l=x();if(!(e.ctrlKey||e.altKey||e.metaKey||a<32)){if(a&&13!==a){if(l.end-l.begin!=0&&(z(l.begin,l.end),A(l.begin,l.end-1)),(r=T(l.begin-1))<d.current&&(n=String.fromCharCode(a),p.current[r].test(n))){if(w(r),g.current[r]=n,B(),t=T(r),u.isAndroid()){setTimeout((function(){x(t)}),0)}else x(t);l.begin<=m.current&&(c=I())}e.preventDefault()}N(e),i.onComplete&&c&&i.onComplete({originalEvent:e,value:S()})}}},onInput:function(e){O.current?D(e):L(e)},onPaste:L,required:i.required,tooltip:i.tooltip,tooltipOptions:i.tooltipOptions}))})));o.displayName="InputMask",o.defaultProps={__TYPE:"InputMask",id:null,value:null,type:"text",mask:null,slotChar:"_",autoClear:!0,unmask:!1,style:null,className:null,placeholder:null,size:null,maxLength:null,tabIndex:null,disabled:!1,readOnly:!1,name:null,required:!1,tooltip:null,tooltipOptions:null,onComplete:null,onChange:null,onFocus:null,onBlur:null};export{o as InputMask};
