import*as e from"react";import n from"primereact/api";import{CSSTransition as t}from"primereact/csstransition";import{useMountEffect as r,useUpdateEffect as o,useOverlayListener as l,useUnmountEffect as a}from"primereact/hooks";import{OverlayService as i}from"primereact/overlayservice";import{Portal as c}from"primereact/portal";import{classNames as u,DomHandler as p,ObjectUtils as s,ZIndexUtils as f}from"primereact/utils";import{Ripple as d}from"primereact/ripple";function m(){return m=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},m.apply(this,arguments)}function v(e){if(Array.isArray(e))return e}function h(e,n){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var r,o,l,a,i=[],c=!0,u=!1;try{if(l=(t=t.call(e)).next,0===n){if(Object(t)!==t)return;c=!1}else for(;!(c=(r=l.call(t)).done)&&(i.push(r.value),i.length!==n);c=!0);}catch(e){u=!0,o=e}finally{try{if(!c&&null!=t.return&&(a=t.return(),Object(a)!==a))return}finally{if(u)throw o}}return i}}function b(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}function y(e,n){if(e){if("string"==typeof e)return b(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?b(e,n):void 0}}function g(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function E(e,n){return v(e)||h(e,n)||y(e,n)||g()}var S=e.memo((function(t){var l=E(e.useState(null),2),a=l[0],i=l[1],c=e.useRef(null),f=function(e){t.onOptionSelect&&t.onOptionSelect(e)},m=function(e,n){var r=e.currentTarget.parentElement;switch(e.key){case"Down":case"ArrowDown":var o=v(r);o&&o.children[0].focus();break;case"Up":case"ArrowUp":var l=h(r);l&&l.children[0].focus();break;case"Right":case"ArrowRight":O(n)&&(a===n?r.children[1].children[0].children[0].focus():i(n));break;case"Left":case"ArrowLeft":i(null);var c=e.currentTarget.parentElement.parentElement.previousElementSibling;c&&c.focus();break;case"Enter":b(e,n);break;case"Tab":case"Escape":t.onPanelHide&&(t.onPanelHide(),e.preventDefault())}e.preventDefault()},v=function e(n){var t=n.nextElementSibling;return t?p.hasClass(t,"p-disabled")||!p.hasClass(t,"p-cascadeselect-item")?e(t):t:null},h=function e(n){var t=n.previousElementSibling;return t?p.hasClass(t,"p-disabled")||!p.hasClass(t,"p-cascadeselect-item")?e(t):t:null},b=function(e,n){O(n)?(i((function(e){return e===n?null:n})),t.onOptionGroupSelect&&t.onOptionGroupSelect({originalEvent:e,value:n})):t.onOptionSelect&&t.onOptionSelect({originalEvent:e,value:w(n)})},y=function(e){t.onOptionGroupSelect&&t.onOptionGroupSelect(e)},g=function(e){return t.optionLabel?s.resolveFieldData(e,t.optionLabel):e},w=function(e){return t.optionValue?s.resolveFieldData(e,t.optionValue):e},O=function(e){return Object.prototype.hasOwnProperty.call(e,t.optionGroupChildren[t.level])},C=function(e){return O(e)?(n=e,t.optionGroupLabel?s.resolveFieldData(n,t.optionGroupLabel):null):g(e);var n};r((function(){if(t.selectionPath&&t.options&&!t.dirty){var e=t.options.find((function(e){return t.selectionPath.includes(e)}));e&&i(e)}var n,r,o,l,a;t.root||(r=p.getOffset(n=c.current.parentElement),o=p.getViewport(),l=c.current.offsetParent?c.current.offsetWidth:p.getHiddenElementOuterWidth(element),a=p.getOuterWidth(n.children[0]),parseInt(r.left,10)+a+l>o.width-p.calculateScrollbarWidth()&&(c.current.style.left="-100%"))})),o((function(){i(null)}),[t.parentActive]);var G=function(n){if(O(n)&&a===n){var r=s.resolveFieldData(n,t.optionGroupChildren[t.level]);return e.createElement(S,{options:r,className:"p-cascadeselect-sublist",selectionPath:t.selectionPath,optionLabel:t.optionLabel,optionValue:t.optionValue,level:t.level+1,onOptionSelect:f,onOptionGroupSelect:y,parentActive:a===n,optionGroupLabel:t.optionGroupLabel,optionGroupChildren:t.optionGroupChildren,dirty:t.dirty,template:t.template,onPanelHide:t.onPanelHide})}return null},A=function(n,r){var o=u("p-cascadeselect-item",{"p-cascadeselect-item-group":O(n),"p-cascadeselect-item-active p-highlight":a===n},n.className),l=G(n),i=t.template?s.getJSXElement(t.template,w(n)):e.createElement("span",{className:"p-cascadeselect-item-text"},C(n)),c=O(n)&&e.createElement("span",{className:"p-cascadeselect-group-icon pi pi-angle-right"}),p=C(n)+"_"+r;return e.createElement("li",{key:p,className:o,style:n.style,role:"none"},e.createElement("div",{className:"p-cascadeselect-item-content",onClick:function(e){return b(e,n)},tabIndex:0,onKeyDown:function(e){return m(e,n)}},i,c,e.createElement(d,null)),l)},P=u("p-cascadeselect-panel p-cascadeselect-items",t.className,{"p-input-filled":"filled"===n.inputStyle,"p-ripple-disabled":!1===n.ripple}),x=t.options?t.options.map(A):null;return e.createElement("ul",{ref:c,className:P,role:"listbox","aria-orientation":"horizontal"},x)}));function w(e,n){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=O(e))||n&&e&&"number"==typeof e.length){t&&(e=t);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,a=!0,i=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return a=e.done,e},e:function(e){i=!0,l=e},f:function(){try{a||null==t.return||t.return()}finally{if(i)throw l}}}}function O(e,n){if(e){if("string"==typeof e)return C(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?C(e,n):void 0}}function C(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}var G=e.memo(e.forwardRef((function(r,d){var v=E(e.useState(!1),2),h=v[0],b=v[1],y=E(e.useState(!1),2),g=y[0],O=y[1],C=e.useRef(null),A=e.useRef(null),P=e.useRef(null),x=e.useRef(null),I=e.useRef(!1),L=e.useRef(null),N=E(l({target:C,overlay:A,listener:function(e,n){n.valid&&q()},when:g}),2),R=N[0],D=N[1],k=function(e){r.onChange&&r.onChange({originalEvent:e,value:e.value}),F(),q(),p.focus(P.current)},T=function(e){I.current=!0,r.onGroupChange&&r.onGroupChange(e)},j=function(e){return(r.optionLabel?s.resolveFieldData(e,r.optionLabel):e)||e},H=function(e){return r.optionValue?s.resolveFieldData(e,r.optionValue):e},V=function(e,n){return s.resolveFieldData(e,r.optionGroupChildren[n])},B=function(e,n){return Object.prototype.hasOwnProperty.call(e,r.optionGroupChildren[n])},F=function(){var e;if(null!=r.value&&r.options){var n,t=w(r.options);try{for(t.s();!(n=t.n()).done;){if(e=K(n.value,0))break}}catch(e){t.e(e)}finally{t.f()}}L.current=e},K=function e(n,t){if(B(n,t)){var o,l,a=w(V(n,t));try{for(a.s();!(l=a.n()).done;){if(o=e(l.value,t+1))return o.unshift(n),o}}catch(e){a.e(e)}finally{a.f()}}else if(s.equals(r.value,H(n),r.dataKey))return[n];return null},_=function(e){r.disabled||A.current&&A.current.contains(e.target)||(p.focus(P.current),g?q():$())},U=function(){b(!0)},W=function(){b(!1)},z=function(e){switch(e.which){case 40:g?p.findSingle(A.current,".p-cascadeselect-item").children[0].focus():e.altKey&&r.options&&r.options.length&&$(),e.preventDefault();break;case 32:g?q():$(),e.preventDefault();break;case 9:q()}},M=function(e){i.emit("overlay-click",{originalEvent:e,target:C.current})},$=function(){r.onBeforeShow&&r.onBeforeShow(),O(!0)},q=function(){r.onBeforeHide&&r.onBeforeHide(),O(!1),p.focus(P.current)},J=function(){f.set("overlay",A.current,n.autoZIndex,n.zIndex.overlay),Q()},X=function(){R(),r.onShow&&r.onShow()},Y=function(){D(),I.current=!1},Z=function(){f.clear(A.current),r.onHide&&r.onHide()},Q=function(){p.alignOverlay(A.current,x.current.parentElement,r.appendTo||n.appendTo)};e.useImperativeHandle(d,(function(){return{props:r,getElement:function(){return C.current},getOverlay:function(){return A.current},getInput:function(){return P.current},getLabel:function(){return x.current},focus:function(){return p.focus(P.current)}}})),e.useEffect((function(){s.combinedRefs(P,r.inputRef)}),[P,r.inputRef]),o((function(){F()}),[r.value]),a((function(){f.clear(A.current)}));var ee=s.findDiffKeys(r,G.defaultProps);s.reduceKeys(ee,p.DATA_PROPS);var ne,te,re,oe,le,ae,ie,ce,ue,pe=s.reduceKeys(ee,p.ARIA_PROPS);return le=u("p-cascadeselect p-component p-inputwrapper",{"p-disabled":r.disabled,"p-focus":h,"p-inputwrapper-filled":r.value,"p-inputwrapper-focus":h||g},r.className),ne=r.value?j(r.value):void 0,ae=e.createElement("div",{className:"p-hidden-accessible"},e.createElement("input",m({ref:P,type:"text",id:r.inputId,name:r.name,defaultValue:ne,readOnly:!0,disabled:r.disabled,onFocus:U,onBlur:W,onKeyDown:z,tabIndex:r.tabIndex,"aria-haspopup":"listbox"},pe))),te=r.value?j(r.value):r.placeholder||"p-emptylabel",re=u("p-cascadeselect-label ",{"p-placeholder":te===r.placeholder,"p-cascadeselect-label-empty":!r.value&&"p-emptylabel"===te}),ie=e.createElement("span",{ref:x,className:re},te),oe=u("p-cascadeselect-trigger-icon",r.dropdownIcon),ce=e.createElement("div",{className:"p-cascadeselect-trigger",role:"button","aria-haspopup":"listbox","aria-expanded":g},e.createElement("span",{className:oe})),ue=e.createElement(c,{element:e.createElement(t,{nodeRef:A,classNames:"p-connected-overlay",in:g,timeout:{enter:120,exit:100},options:r.transitionOptions,unmountOnExit:!0,onEnter:J,onEntered:X,onExit:Y,onExited:Z},e.createElement("div",{ref:A,className:"p-cascadeselect-panel p-component",onClick:M},e.createElement("div",{className:"p-cascadeselect-items-wrapper"},e.createElement(S,{options:r.options,selectionPath:L.current,className:"p-cascadeselect-items",optionLabel:r.optionLabel,optionValue:r.optionValue,level:0,optionGroupLabel:r.optionGroupLabel,optionGroupChildren:r.optionGroupChildren,onOptionSelect:k,onOptionGroupSelect:T,root:!0,template:r.itemTemplate,onPanelHide:q})))),appendTo:r.appendTo}),e.createElement("div",m({ref:C,id:r.id,className:le,style:r.style},ee,{onClick:_}),ae,ie,ce,ue)})));G.displayName="CascadeSelect",G.defaultProps={__TYPE:"CascadeSelect",id:null,inputRef:null,style:null,className:null,value:null,name:null,options:null,optionLabel:null,optionValue:null,optionGroupLabel:null,optionGroupChildren:null,placeholder:null,itemTemplate:null,disabled:!1,dataKey:null,inputId:null,tabIndex:null,ariaLabelledBy:null,appendTo:null,transitionOptions:null,dropdownIcon:"pi pi-chevron-down",onChange:null,onGroupChange:null,onBeforeShow:null,onBeforeHide:null,onShow:null,onHide:null};export{G as CascadeSelect};
